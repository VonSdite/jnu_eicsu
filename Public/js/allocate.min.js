window.onload=allocateSystemInit;var exChangedButton="cha_xun_ke_biao";var arrDepartName=new Array("秘书处","人力资源部","宣传部","信息编辑部","学术部","体育部","JDC","组织部","文娱部","公关部","心理服务部","主席团");var arrTypeName=new Array("干事","人力干事","部长级","主席团");var arrGenderName=new Array("不确定","女","男");var arrSKSJ=new Array({"b":480,"e":525},{"b":535,"e":580},{"b":600,"e":645},{"b":655,"e":700},{"b":760,"e":805},{"b":815,"e":860},{"b":870,"e":915},{"b":925,"e":970},{"b":980,"e":1025},{"b":1035,"e":1080},{"b":1140,"e":1185},{"b":1195,"e":1240},{"b":1250,"e":1295});var arrAllocRequire;var arrTime;function debug()
{return false;}
function errmsg()
{if(!debug())
{alert("AJAX通信错误,请与管理员联系");throw"ajax error";}}
function changeButtonStyle(buttonName)
{$("#"+exChangedButton).attr("class","alloc_check_div used");$("#"+buttonName).attr("class","alloc_check_div_click");exChangedButton=buttonName;}
function GetReqKongKeLst(bh,bm,eh,em)
{var bt=bh*60+bm;var et=eh*60+em;var ret=new Array();console.log("bh:"+bh+" bm:"+bm+" eh:"+eh+" em:"+em);for(var i=0;i<arrSKSJ.length;i++)
{if((bt>=arrSKSJ[i].b&&bt<=arrSKSJ[i].e)||(et>=arrSKSJ[i].b&&et<=arrSKSJ[i].e)||(bt<=arrSKSJ[i].b&&et>=arrSKSJ[i].b))
{ret.push(i)}}
console.log(ret);return ret;}
var currentUser
function allocateSystemInit()
{currentUser=GetUserData($("#login_info_user_id").html());var strButtonInfo="<div class=\"alloc_check_div used\" id=\"cha_xun_ke_biao\" title=\"查询可调人员\">\n"
+"<p>查询可调人员</p>\n"
+"</div>\n"
+"<div class=\"alloc_check_div used\" id=\"cha_xun_kkb\" title=\"查询空课表\">\n"
+"<p>查询空课表</p>\n"
+"</div>\n"
+"<div class=\"alloc_check_div used\" id=\"qiandao_qianli\" title=\"签到签离记录\">\n"
+" <p>签到签离记录</p>\n"
+"</div>\n"
+"<div class=\"alloc_check_div used\" id=\"cancle_alloc\" title=\"取消或修改一次外调\">\n"
+" <p>取消\\修改外调</p>\n"
+"</div>\n"
+"<div class=\"alloc_check_div wacd\">\n"
+" <p></p>\n"
+"</div>\n";$("#alloc_bu_div").hide().html(strButtonInfo).slideDown();if(currentUser.userType!=2)
{$("#qiandao_qianli,#cancle_alloc").attr("class","alloc_check_div used unable");$("#cha_xun_ke_biao").click(showChaXunKeBiao);$("#cha_xun_kkb").click(showChaXunKKB);}
else
{$("#cha_xun_ke_biao").click(showChaXunKeBiao);$("#cha_xun_kkb").click(showChaXunKKB);$("#qiandao_qianli").click(showQianDaoQianLi);$("#cancle_alloc").click(showCancleAlloc);}
showChaXunKeBiao();}
function GetUserData(strUserID)
{try{if(debug())
throw("ajax");var jsonReturn;$.ajax({url:URL+"/postUserData",data:{},async:false,dataType:"json",type:"POST",success:function(result){jsonReturn=result;}});var jsonUD=jsonReturn;}
catch(err){console.log(err);var jsonUD={"_userID":strUserID,"_userType":2,"_depart":2,};errmsg();}
function objUserData(_userID,_userType,_depart)
{this.userID=_userID;this.userType=_userType;this.depart=_depart;}
console.log(jsonUD);var objUD=new objUserData(jsonUD._userID,jsonUD._userType,jsonUD._depart);return objUD;}
function postAllocQueInfo(objQI)
{var ret=GetReqKongKeLst(objQI.qBeginHour,objQI.qBeginMin,objQI.qEndHour,objQI.qEndMin);var qArrKK=new Array();for(var i=0;i<ret.length;i++)
{qArrKK.push({"qKongKe":ret[i]});}
console.log(qArrKK);try{if(debug())
throw("ajax");var jsonPost={"qDepart":objQI.qDepart+1,"qYear":objQI.qYear,"qMonth":objQI.qMonth,"qDay":objQI.qDay,"qBeginHour":objQI.qBeginHour,"qBeginMin":objQI.qBeginMin,"qEndHour":objQI.qEndHour,"qEndMin":objQI.qEndMin,"qGender":objQI.qGender,"qArrKK":qArrKK,};var jsonReturn;$.ajax({url:URL+"/getAllocInfo",data:jsonPost,async:false,dataType:"json",type:"POST",success:function(result){jsonReturn=result;}});arrTime=jsonReturn.arrTime;var arrAnsPerInfo=new Array();var jsonGet=jsonReturn;arrAllocRequire=jsonReturn.arrAllocRequire;}
catch(err){var jsonGet={"arrAnsPerInfo":[{"conformity":"0.3","userID":"2012052201","userName":"邓作恒1","freeTime":"0.3","depart":"2","userType":"3","gender":"1","longPhoneNumber":"13726247196","shortPhoneNumber":"617196","total_alloc_time":"5","recently_alloc_time":"2",},],};errmsg();}
if(jsonGet.arrAnsPerInfo.length!=0){jsonGet.arrAnsPerInfo.sort(function(lhs,rhs){if(lhs.conformity==rhs.conformity){if(lhs.userType==rhs.userType){if(lhs.total_alloc_time==rhs.total_alloc_time){if(lhs.recently_alloc_time==rhs.recently_alloc_time){return parseInt(rhs.gender)-parseInt(lhs.gender);}
else{parseInt(lhs.recently_alloc_time)-parseInt(rhs.recently_alloc_time);}}
else{return parseInt(lhs.total_alloc_time)-parseInt(rhs.total_alloc_time);}}
else{return parseInt(lhs.userType)-parseInt(rhs.userType);}}
else{return parseInt(rhs.conformity)-parseInt(lhs.conformity);}});}
return jsonGet.arrAnsPerInfo;}
function postAllocFormArr(arrIDList)
{var jsonArr=new Array();for(var i=0;i<arrIDList.length;i++)
{var jsonID={"strID":arrIDList[i]};jsonArr.push(jsonID);}
var jsonPOST={"jsonITList":jsonArr,"arrAllocRequire":arrAllocRequire,"arrTime":arrTime,}
console.log(jsonPOST);try{if(debug())
throw("ajax");var jsonReturn;$.ajax({url:URL+"/postAllocCode",data:jsonPOST,async:false,dataType:"json",type:"POST",success:function(result){jsonReturn=result;}});var jsonGet={"allocCode":jsonReturn.code};return jsonGet.allocCode;}
catch(err){errmsg();return"20140828-QWER";}}
function getKKBList()
{try{if(debug())
throw("ajax");var jsonReturn;$.ajax({url:URL+"/postKongKeBiao",data:{},async:false,dataType:"json",type:"POST",success:function(result){jsonReturn=result;}});var jsonGet=jsonReturn;}
catch(err){var jsonGet={"arrKKBLinkList":[{"name":"KSC联盟空课表","link":"#",},{"name":"人力资源部空课表","link":"#",},{"name":"体育部空课表","link":"#",},],};errmsg();}
return jsonGet.arrKKBLinkList;}
function postAllocCode(strCode)
{try{if(debug())
throw("ajax");var jsonPsot={"allocCode":strCode};var jsonReturn;$.ajax({url:URL+"/getAllocCode",data:jsonPsot,async:false,dataType:"json",type:"POST",success:function(result){jsonReturn=result;}});var jsonGet=jsonReturn;}
catch(err){var jsonGet={"arrAllocedList":[{"ID":"2012052207","name":"邓作恒1","allocResult":"1",},],};errmsg();}
return jsonGet.arrAllocedList;}
function postAllocPerfValue(arrAllocedStudents)
{var jsonArr=new Array();console.log(arrAllocedStudents);for(var i=0;i<arrAllocedStudents.length;i++)
{var jsonPer={"ID":arrAllocedStudents[i].ID,"BX":arrAllocedStudents[i].allocResult};jsonArr.push(jsonPer);}
console.log(jsonArr);var AllocCode=document.forms["code_input"].elements["alloc_code"].value;var jsonPOST={"arrAllocedPerf":jsonArr,"AllocCode":AllocCode,};try{if(debug())
throw("ajax");var jsonReturn;$.ajax({url:URL+"/getAllocPerform",data:jsonPOST,async:false,dataType:"json",type:"POST",success:function(result){jsonReturn=result;}});console.log("发送外调表现结果的返回值:"+jsonReturn);return true;}
catch(err)
{errmsg();return true;}}
function postAllocCodeforCancel(strCode)
{try{if(debug())
throw("ajax");var jsonPost={"allocCode":strCode};var jsonReturn;$.ajax({url:URL+"/getAllocCancel",data:jsonPost,async:false,dataType:"json",type:"POST",success:function(result){jsonReturn=result;}});var jsonGet=jsonReturn;}
catch(err){var jsonGet={"exist":"exist","code":strCode,"applyTime":"2012-13-13 25:60:60","operator":"邓作恒","applyDepart":"KSC联盟","workTime":"2012-14-14 16:30--17:40",}}
return jsonGet;}
function cancelAlloc(strCode)
{try{if(debug())
throw("ajax");var jsonPsot={"allocCode":strCode};var jsonReturn;$.ajax({url:URL+"/setAllocCancel",data:jsonPsot,async:false,dataType:"json",type:"POST",success:function(result){jsonReturn=result;}});console.log(jsonReturn.back);return true;}
catch(err)
{errmsg();return true;}}
function showChaXunKeBiao()
{changeButtonStyle("cha_xun_ke_biao");$("#alloc_work_f").html("<div id='alloc_work_f_inner'></div>");var strAllocQ="<div id=\"alloc_q\">\n"
+"<form name=\"alloc_q_form\" method=\"post\" action=\"#\">\n"
+"<h2>申请部门</h2>\n"
+"<select class=\"alloc_select\" name=\"shenqingbumen\" id=\"shengqingbumen\">\n";for(var iCount=0;iCount<arrDepartName.length;iCount++)
{strAllocQ+="<option value=\""+iCount+"\"";if(iCount==currentUser.depart-1)
{strAllocQ+="selected=\"selected\"";}
strAllocQ+=">"+arrDepartName[iCount]+"</option>\n";}
strAllocQ+="</select><span id='tips_depart'></span>\n"
+"<h2>查询条件</h2>\n"
+"<p>\n"
+"工作日期：\n"
+"<select class=\"alloc_select\" name=\"shijian_nian\" id=\"shijian_nian\">\n";var date=new Date();var currentYear=date.getFullYear();strAllocQ+="<option value=\""+currentYear+"\">"+currentYear+"</option>";strAllocQ+="<option value=\""+(currentYear+1)+"\">"+(currentYear+1)+"</option>";strAllocQ+="</select>";strAllocQ+="年\\";strAllocQ+="<select class=\"alloc_select\" name=\"shijian_yue\" id=\"shijian_yue\">\n";for(var iCount=0;iCount<12;iCount++)
{strAllocQ+="<option value=\""+(iCount+1)+"\">"+(iCount+1)+"</option>\n";}
strAllocQ+="</select>"
+"月\\"
+"<select class=\"alloc_select\" name=\"shijian_ri\" id=\"shijian_ri\">\n";for(var iCount=0;iCount<31;iCount++)
{strAllocQ+="<option value=\""+(iCount+1)+"\">"+(iCount+1)+"</option>\n";}
strAllocQ+="</select>\n"
+"日\n"
+"<span id='tips_work_day'></span>"
+"</p>\n"
+"<p>\n"
+"工作时间：\n"
+"<select class=\"alloc_select\" name=\"shijian_kaishi_h\" id=\"shijian_kaishi_h\">\n";for(var iCount=5;iCount<23;iCount++)
{strAllocQ+="<option value=\""+iCount+"\">"+iCount+"</option>\n";}
strAllocQ+="</select>\n"
+":\n"
+"<select class=\"alloc_select\" name=\"shijian_kaishi_fen\" id=\"shijian_kaishi_fen\">";for(var iCount=0;iCount<6;iCount++)
{strAllocQ+="<option value=\""+iCount+"0"+"\">"+iCount+"0"+"</option>\n";}
strAllocQ+="</select>\n"
+" — —\n"
+" <select class=\"alloc_select\" name=\"shijian_jieshu_h\" id=\"shijian_jieshu_h\">\n";for(var iCount=5;iCount<23;iCount++)
{strAllocQ+="<option value=\""+iCount+"\">"+iCount+"</option>\n";}
strAllocQ+="</select>\n"
+":\n"
+"<select class=\"alloc_select\" name=\"shijian_jieshu_fen\" id=\"shijian_jieshu_fen\">\n";for(var iCount=0;iCount<6;iCount++)
{strAllocQ+="<option value=\""+iCount+"0"+"\">"+iCount+"0"+"</option>\n";}
strAllocQ+="</select><span id='tips_work_time'></span><a href=\"#\" id=\"help\">帮助</a>\n"
+"</p>\n"
+"<p>\n"
+" 性别要求：\n"
+" <select class=\"alloc_select\" name=\"teshu_sex\" id=\"teshu_sex\">\n"
+"  <option value=\"0\" selected=\"selected\">不限</option>\n"
+"  <option value=\"1\">女</option>\n"
+"  <option value=\"2\">男</option>\n"
+" </select>\n"
+"</p>\n"
+"<div id=\"time_error\" class=\"alloc_code_error\"></div>"
+"<p>\n"
+" <button class=\"alloc_sub_bu\" type=\"button\" name=\"q_submit\" id=\"q_submit\" title=\"提交查询\">\n"
+"  查询\n"
+" </button>\n"
+"</p>\n"
+"</form>\n"
+"<hr />\n"
+"</div>\n"
+"<div id=\"q_result\"></div>"
+"<div id=\"alloc_succeed\"></div>";$("#alloc_work_f_inner").hide().html(strAllocQ).slideDown();$("#shengqingbumen").change(function(){$("#tips_depart").html("&emsp;搜索结果中不会显示"+arrDepartName[$(this).val()]+"的人员");});$("#shijian_nian,#shijian_yue,#shijian_ri").change(function(){tips_qYear=parseInt($("#shijian_nian").val());tips_qMonth=parseInt($("#shijian_yue").val());tips_qDay=parseInt($("#shijian_ri").val());var str_tips=new String();Date.prototype.getWeekOfYear=function(weekStart){weekStart=(weekStart||0)-0;if(isNaN(weekStart)||weekStart>6)
weekStart=0;var year=this.getFullYear();var firstDay=new Date(year,0,1);var firstWeekDays=7-firstDay.getDay()+weekStart;var dayOfYear=(((new Date(year,this.getMonth(),this.getDate()))-firstDay)/(24*3600*1000))+1;return Math.ceil((dayOfYear-firstWeekDays)/7)+1;}
var d0=GLOBAL_SEMESTER_START;var d1=new Date(tips_qYear,tips_qMonth-1,tips_qDay);console.log(d1);console.log(d1.getWeekOfYear(1));console.log(d0);console.log(d0.getWeekOfYear(1));var isDanzou=(d1.getWeekOfYear(1)-d0.getWeekOfYear(1))%2;if(isDanzou==0)
{str_tips+="第"+(d1.getWeekOfYear(1)-d0.getWeekOfYear(1)+1)+"周,单周";}
else
{str_tips+="第"+(d1.getWeekOfYear(1)-d0.getWeekOfYear(1)+1)+"周,双周";}
today=new Date();if((today.getMonth()>tips_qMonth)||(today.getMonth()==tips_qMonth&&today.getDate()>tips_qDay))
{str_tips+="日期早于今天，不科学";}
var arrAloMonth=[-1,11,12,1,2,3,4,5,6,7,8,9,10];tips_qMonth=arrAloMonth[tips_qMonth];w=(tips_qDay+parseInt(2.6*tips_qMonth-0.2)+5*(tips_qYear%4)+3*tips_qYear+5*(21%4))%7;var weekDays=["一","二","三","四","五","六","日"];str_tips+="星期"+weekDays[w];$("#tips_work_day").html(str_tips);});$("#shijian_kaishi_h,#shijian_kaishi_fen,#shijian_jieshu_h,#shijian_jieshu_fen").change(function(){var bh=parseInt($("#shijian_kaishi_h").val());var eh=parseInt($("#shijian_jieshu_h").val());var em=parseInt($("#shijian_jieshu_fen").val());var bm=parseInt($("#shijian_kaishi_fen").val());if((bh*60+bm)-(eh*60+em)>0)
{$("#tips_work_time").html("*开始时间晚于结束时间，这不科学");return;}
var ret=GetReqKongKeLst(bh,bm,eh,em);if(ret.length>0)
{var str=new String("需要第");for(var i=0;i<ret.length;i++)
{str+=ret[i]+1;str+=","}
str+="节课没课&emsp;&emsp;";$("#tips_work_time").html(str);}});$("#help").click(function(){alert("此处工作时间用于查询空课表\n"+"系统先用此时间判断那节课需要为空才能符合工作时间\n"+"判断标准如下：\n"+"开始时间在一节课中间的，要求空\n结束时间在一节课中间的，要求空\n在这节课前开始，在这节课前没结束的，要求空");return false;});$("#q_submit").click(function()
{var strError=new String();var objForm=document.forms["alloc_q_form"];if(2==$("#shijian_yue").val()&&29<$("#shijian_ri").val())
{strError+="*2月没有"+$("#shijian_ri").val();}
var bh=parseInt($("#shijian_kaishi_h").val());var eh=parseInt($("#shijian_jieshu_h").val());var em=parseInt($("#shijian_jieshu_fen").val());var bm=parseInt($("#shijian_kaishi_fen").val());if((bh*60+bm)-(eh*60+em)>0)
{strError+="*开始时间晚于结束时间，这不科学\n";}
if(strError!="")
{$("#time_error").html(strError);return false;}
else
{$("#time_error").html("");function objQueInfo()
{this.qDepart=parseInt($("#shengqingbumen").val());this.qYear=parseInt($("#shijian_nian").val());this.qMonth=parseInt($("#shijian_yue").val());this.qDay=parseInt($("#shijian_ri").val());this.qBeginHour=parseInt($("#shijian_kaishi_h").val());this.qBeginMin=parseInt($("#shijian_kaishi_fen").val());this.qEndHour=parseInt($("#shijian_jieshu_h").val());this.qEndMin=parseInt($("#shijian_jieshu_fen").val());this.qGender=parseInt($("#teshu_sex").val());}
var objQI=new objQueInfo();today=new Date();qday=new Date(objQI.qYear,objQI.qMonth-1,objQI.qDay,objQI.qEndHour,objQI.qEndMin);if(today.getTime()>=qday.getTime())
{alert("查询时间早于当前!");return false;}
var arrResponse=postAllocQueInfo(objQI);function getShortPhoneNumStr(strspn)
{try{var char_=strspn[0];var icount=1;for(var i=1;i<6;i++)
{if(strspn[i]==char_)
{icount++;}}
if(icount==6)
{return"-";}
else
{return strspn;}}catch(err){return"-";}}
if(arrResponse.length!=0)
{var strQueryReTable=new String();strQueryReTable+="<h2>查询结果</h2>\n"
+" <form method=\"post\" action=\"#\" name=\"alloc_list_form\">\n"
+"  <table class=\"alloc_mb_table\">\n"
+"   <thead>\n"
+"    <tr>\n"
+"     <th>调用</th>\n"
+"     <th>姓名</th>\n"
+"     <th>空课时间</th>\n"
+"     <th>所属部门</th>\n"
+"     <th>用户类型</th>\n"
+"     <th>性别</th>\n"
+"     <th>长号</th>\n"
+"     <th>短号</th>\n"
+"     <th>累计/最近外调数</th>\n"
+"    </tr>\n"
+"   </thead>\n"
+"   <tbody>\n";for(var i=0;i<arrResponse.length;i++)
{if(!arrResponse[i].userName){continue;}
strQueryReTable+="<tr><td><input type=\"checkbox\" name=\""+arrResponse[i].userID+"\" value=\""+arrResponse[i].userID+"\"/></td>"
+"<td>"+arrResponse[i].userName+"</td>"
+"<td>"+arrResponse[i].freeTime.toFixed(2)+"</td>"
+"<td>"+arrDepartName[arrResponse[i].depart-1]+"</td>"
+"<td>"+arrTypeName[arrResponse[i].userType-1]+"</td>"
+"<td>"+arrGenderName[arrResponse[i].gender]+"</td>"
+"<td>"+arrResponse[i].longPhoneNumber+"</td>"
+"<td>"+getShortPhoneNumStr(arrResponse[i].shortPhoneNumber)+"</td>"
+"<td>"+(arrResponse[i].total_alloc_time+"/"+arrResponse[i].recently_alloc_time)+"</td>"
+"</tr>";}
strQueryReTable+="</tbody></table><div id=\"verification\"><div>";if(currentUser.userType==2)
{strQueryReTable+="<button class=\"alloc_sub_bu\" type=\"button\" name=\"al_submit\" id=\"al_submit\" title=\"调用选中人\">\n"
+"调用选中人\n"
+"</button>\n"
+"</form>\n"
$("#q_result").hide().html(strQueryReTable).slideDown();}
else
{$("#q_result").hide().html(strQueryReTable).slideDown();}
$("#al_submit").click(function()
{var objAllocFormList=document.forms["alloc_list_form"];var arrIDList=new Array();for(var i=0;i<arrResponse.length;i++)
{var checked=false;try{checked=objAllocFormList.elements[i].checked;}catch(e){}
if(true==checked)
{arrIDList.push(objAllocFormList.elements[i].name);}}
var strAllocCode=postAllocFormArr(arrIDList);if(0==arrIDList.length)
{alert("你必须选择你要外调的同学!");}
else
{var strAllSucceed="<p>调用成功！</p><p>本次外调序列号：</p><p>"+strAllocCode+"</p>";strAllSucceed+="<div class=\"alloc_code_error\">"
+"*请务必记住外调序列号！"
+"</div>";strAllSucceed+="<button class=\"alloc_sub_bu\" type=\"button\" name=\"al_succeed\" id=\"al_succeed\" title=\"返回前请记住外调序列号\">\n"
+"确认并返回\n"
+"</button>\n";$("#alloc_succeed").hide().html(strAllSucceed).slideDown();$("#al_submit").hide();$("#al_succeed").click(showChaXunKeBiao);}});}
else
{var strQueryReTable;strQueryReTable="<h2>查询无结果o(╯□╰)o</h2>\n";$("#q_result").html(strQueryReTable);}}});}
function showQianDaoQianLi(currentUser)
{changeButtonStyle("qiandao_qianli");var strCodeQue=new String();strCodeQue+=" <div id=\"code_s_q\">\n"
+"  <h2>外调序列号</h2>\n"
+"  <div id=\"code_tips\">\n"
+"   输入外调序列号:\n"
+"  </div>\n"
+"  <form method=\"post\" action=\"#\" name=\"code_input\">\n"
+"   <input type=\"text\" id=\"alloc_code\" name=\"alloc_code\" />\n"
+"   <div id=\"alloc_code_error\" class=\"alloc_code_error\"></div>\n"
+"   <button type=\"button\" id=\"alloc_code_sub\" name=\"alloc_code_sub\" class=\"alloc_sub_bu\" title=\"外调序列号提交按钮\">确定</button>\n"
+"  </form>\n"
+"  <hr />\n"
+" </div>\n"
+" <div id=\"pref_radio_s\"></div>\n";$("#alloc_work_f").html("<div id='alloc_work_f_inner'></div>");$("#alloc_work_f_inner").hide().html(strCodeQue).slideDown();function invalidCode(Code)
{var re=/^\d{8}-[A-Z]{4}$/;return re.test(Code);}
$("#alloc_code_sub").click(function()
{var strCode=$("#alloc_code").val();if(true==invalidCode(strCode))
{$("#alloc_code_error").html("");var arrAllocedStudents=postAllocCode(strCode);var strAllocPerf=new String();if(0!=arrAllocedStudents.length)
{strAllocPerf+="<h2>外调表现表</h2>\n"
+"<form method=\"post\" action=\"#\" name=\"alloc_perf_form_list\">\n"
+" <table id=\"qiandaoqianli_table\" class=\"alloc_mb_table\">\n"
+"  <thead>\n"
+"   <tr>\n"
+"    <th>姓名</th>\n"
+"    <th>外调表现</th>\n"
+"   </tr>\n"
+"  </thead>\n"
+"  <tbody>\n";var arrResultName=new Array("缺席","取消外调","正常出席","推优");for(var i=0;i<arrAllocedStudents.length;i++)
{strAllocPerf+="<tr><td>"
+arrAllocedStudents[i].name
+"</td><td class=\"width_400\">";for(var j=0;j<arrResultName.length;j++)
{strAllocPerf+="<label for=\""+(arrAllocedStudents[i].ID+"_p"+j)+"\">"+arrResultName[j]+"</label>"
+"<input type=\"radio\" name=\""
+arrAllocedStudents[i].ID
+"\" id=\""
+(arrAllocedStudents[i].ID+"_p1")
+"\" value=\""+(j+1)+"\" ";if(j==arrAllocedStudents[i].allocResult-1)
{strAllocPerf+="checked=\"checked\"";}
strAllocPerf+="class=\"alloc_perf_radio\" />";}}
strAllocPerf+="</tbody></table>\n"
+"<button type=\"button\" id=\"alloc_pref_sub\" name=\"alloc_pref_sub\" class=\"alloc_sub_bu\" title=\"外调表现表提交按钮\">提交</button>\n"
+"</form>\n";}
else
{strAllocPerf+="<h2>找不到"+strCode+"对应的外调!</h2>";}
$("#pref_radio_s").hide().html(strAllocPerf).slideDown();try{$("#alloc_pref_sub").click(function()
{for(var iCount=0;iCount<arrAllocedStudents.length;iCount++)
{var arrRadios=document.getElementsByName(arrAllocedStudents[iCount].ID);for(var j=0;j<arrRadios.length;j++)
{if(true==arrRadios[j].checked)
{arrAllocedStudents[iCount].allocResult=arrRadios[j].value;}}}
if(true==postAllocPerfValue(arrAllocedStudents))
{alert("外调"+strCode+"的考核结果提交成功！点击确定返回");showQianDaoQianLi();}
else
{alert("提交失败。。请重试。。");}});}catch(err){}}
else
{$("#alloc_code_error").html("*外调序列号格式错误");}});}
function showChaXunKKB()
{changeButtonStyle("cha_xun_kkb");var arrKKBLinkList=getKKBList();var strLinkButton=new String();for(var i=0;i<arrKKBLinkList.length;i++)
{strLinkButton+="<div class=\"bmkkb_bu\" ><a href=\""
+arrKKBLinkList[i].link+"\" class=\"bmkkb\"><p>"
+arrKKBLinkList[i].name+"</p></a></div>";}
$("#alloc_work_f").html("<div id='alloc_work_f_inner'></div>");$("#alloc_work_f_inner").hide().html(strLinkButton).slideDown();}
function showCancleAlloc()
{changeButtonStyle("cancle_alloc");$("#alloc_work_f").html("<div id='alloc_work_f_inner'></div>");var strCodeQue=new String();strCodeQue+=" <div id=\"code_s_q\">\n"
+"  <h2>外调序列号</h2>\n"
+"  <div id=\"code_tips\">\n"
+"   输入外调序列号:\n"
+"  </div>\n"
+"  <form method=\"post\" action=\"#\" name=\"code_input\">\n"
+"   <input type=\"text\" id=\"alloc_code\" name=\"alloc_code\" />\n"
+"   <div id=\"alloc_code_error\" class=\"alloc_code_error\"></div>\n"
+"   <button type=\"button\" id=\"alloc_code_sub\" name=\"alloc_code_sub\" class=\"alloc_sub_bu\" title=\"外调序列号提交按钮\">确定</button>\n"
+"  </form>\n"
+"  <hr />\n"
+" </div>\n"
+" <div id=\"decide_cancel_alloc\"></div>\n";$("#alloc_work_f_inner").hide().html(strCodeQue).slideDown();function invalidCode(Code)
{var re=/^\d{8}-[A-Z]{4}$/;return re.test(Code);}
$("#alloc_code_sub").click(function()
{var strCode=$("#alloc_code").val();if(true==invalidCode(strCode))
{$("#alloc_code_error").html("");var objAllocData=postAllocCodeforCancel(strCode);var strVerifyInfo=new String();if("exist"==objAllocData.exist)
{strVerifyInfo+="<h2>确定取消此次外调</h2>\n"
+"<div id=\"this_alloc_info\">\n"
+"<p>外调序列号："+objAllocData.code+"</p>"
+"<p>外调生成时间:"+objAllocData.applyTime+"</p>"
+"<p>操作员："+objAllocData.operator+"</p>"
+"<p>外调申请部门："+arrDepartName[objAllocData.applyDepart-1]+"</p>"
+"<p>外调工作时间："+objAllocData.workTime+"</p>"
+"</div>"
+"<button type=\"button\" id=\"decide_cancel_alloc_sub\" name=\"decide_cancel_alloc_sub\" class=\"alloc_sub_bu\" title=\"确定取消此次外调\">"
+"取消此次外调</button><div id=\"cancel_succeed\"></div>";}
else
{strVerifyInfo+="<h2>找不到"+strCode+"对应的外调!</h2>";}
$("#decide_cancel_alloc").hide().html(strVerifyInfo).slideDown();$("#decide_cancel_alloc_sub").click(function()
{$(this).slideUp();if(true==cancelAlloc(strCode))
{strCancelSucceed=new String();strCancelSucceed+="<p>外调"+strCode+"已经被取消</p>"
+"<button type=\"button\" id=\"confirm_the_result\" name=\"confirm_the_result\" class=\"alloc_sub_bu\" title=\"确定并返回\">"
+"确定并返回</button>";$("#cancel_succeed").hide().html(strCancelSucceed).slideDown();$("#decide_cancel_alloc_sub").hide();$("#confirm_the_result").click(showCancleAlloc);}
else
{alert("操作失败，请重试。。");return false;}});}
else
{$("#alloc_code_error").html("*外调序列号格式错误");}});}